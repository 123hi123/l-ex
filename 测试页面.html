<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discourse è¡¨æƒ…æ‰©å±• - åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
            padding: 10px;
            background: #f0f0f0;
            border-left: 4px solid #4CAF50;
        }
        .feature {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
        }
        .feature h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .demo-textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .demo-textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .button:hover {
            background: #45a049;
        }
        ul {
            line-height: 1.8;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ Discourse è¡¨æƒ…æ‰©å±• - æ–°åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        
        <div class="success-box">
            <strong>âœ… æ›´æ–°æˆåŠŸï¼</strong> æ‚¨çš„è„šæœ¬å·²ç»æ·»åŠ äº†ä»¥ä¸‹æ–°åŠŸèƒ½ï¼š
        </div>

        <h2>ğŸ“Œ åŠŸèƒ½ 1ï¼šTextarea ç‚¹å‡»è‡ªåŠ¨åˆ·æ–°</h2>
        <div class="feature">
            <h3>åŠŸèƒ½è¯´æ˜</h3>
            <p>å½“æ‚¨ç‚¹å‡» Discourse ç¼–è¾‘å™¨çš„ textarea æ—¶ï¼Œä¸‰ä¸ªæ‰©å±•æŒ‰é’®ä¼šè‡ªåŠ¨åˆ·æ–°ï¼š</p>
            <ul>
                <li>ğŸˆâ€â¬› è¡¨æƒ…åŒ…æŒ‰é’®</li>
                <li>â­ å¸¸ç”¨è¡¨æƒ…æŒ‰é’®</li>
                <li>â˜ å¿«æ·è¾“å…¥æŒ‰é’®</li>
            </ul>

            <h3>ä½¿ç”¨æ–¹æ³•</h3>
            <div class="info-box">
                <strong>æ­¥éª¤ï¼š</strong>
                <ol>
                    <li>åœ¨ Discourse è®ºå›æ‰“å¼€ä»»ä½•å¯ä»¥è¾“å…¥çš„åœ°æ–¹</li>
                    <li>ç‚¹å‡» textarea è¾“å…¥æ¡†</li>
                    <li>è§‚å¯Ÿå·¥å…·æ ä¸Šçš„æ‰©å±•æŒ‰é’®ä¼šè‡ªåŠ¨åˆ·æ–°</li>
                </ol>
            </div>

            <h3>æŠ€æœ¯å®ç°</h3>
            <div class="code-block">
// ä¸º textarea æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
function setupTextareaClickHandlers() {
    const textareas = document.querySelectorAll(
        'textarea.chat-composer__input, ' +
        'textarea[data-chat-composer-context="channel"]'
    );
    
    textareas.forEach((textarea) => {
        textarea.addEventListener('click', () => {
            // åˆ·æ–°æ‰©å±•æŒ‰é’®
            refreshExtensionButtons();
        });
    });
}
            </div>
        </div>

        <h2>ğŸ–¼ï¸ åŠŸèƒ½ 2ï¼šæ”¹è¿›çš„å›¾ç‰‡ç²˜è´´åŠŸèƒ½</h2>
        <div class="feature">
            <h3>åŠŸèƒ½è¯´æ˜</h3>
            <p>æ”¯æŒç›´æ¥ç²˜è´´å›¾ç‰‡æ–‡ä»¶ï¼Œè‡ªåŠ¨ä¸Šä¼ å¹¶æ’å…¥å›¾ç‰‡é“¾æ¥åˆ°ç¼–è¾‘å™¨ä¸­ã€‚</p>

            <h3>ä½¿ç”¨æ–¹æ³•</h3>
            <div class="info-box">
                <strong>æ­¥éª¤ï¼š</strong>
                <ol>
                    <li>åœ¨ä»»ä½•åº”ç”¨ä¸­å¤åˆ¶ä¸€å¼ å›¾ç‰‡ï¼ˆä¾‹å¦‚ï¼šæˆªå›¾ã€ä»æ–‡ä»¶ç®¡ç†å™¨å¤åˆ¶ç­‰ï¼‰</li>
                    <li>åœ¨ Discourse ç¼–è¾‘å™¨ä¸­æŒ‰ <code>Ctrl+V</code>ï¼ˆWindowsï¼‰æˆ– <code>Cmd+V</code>ï¼ˆMacï¼‰ç²˜è´´</li>
                    <li>è„šæœ¬ä¼šè‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨</li>
                    <li>ä¸Šä¼ å®Œæˆåï¼Œå›¾ç‰‡é“¾æ¥ä¼šè‡ªåŠ¨æ’å…¥åˆ°å…‰æ ‡ä½ç½®</li>
                </ol>
            </div>

            <h3>æ¨¡æ‹Ÿæ¼”ç¤º</h3>
            <p>åœ¨ä¸‹æ–¹ textarea ä¸­ç²˜è´´å›¾ç‰‡è¯•è¯•çœ‹ï¼ˆè¿™åªæ˜¯æ¼”ç¤ºï¼Œå®é™…åŠŸèƒ½éœ€è¦åœ¨ Discourse è®ºå›ä½¿ç”¨ï¼‰ï¼š</p>
            <textarea 
                class="demo-textarea" 
                placeholder="åœ¨è¿™é‡Œç²˜è´´å›¾ç‰‡...ï¼ˆå®é™…åŠŸèƒ½éœ€è¦åœ¨ Discourse è®ºå›ä¸­ä½¿ç”¨ï¼‰"
                id="demoTextarea"
            ></textarea>
            <div id="pasteResult" style="margin-top: 10px;"></div>

            <h3>æ’å…¥æ ¼å¼</h3>
            <div class="code-block">
// æ’å…¥çš„ Markdown æ ¼å¼
![image](https://example.com/uploads/image.jpg)

// ç¤ºä¾‹
![image](https://linux.do/uploads/default/original/4X/f/4/7/f479dbd.webp)
            </div>

            <h3>æ”¯æŒçš„ç¼–è¾‘å™¨</h3>
            <ul>
                <li>âœ… Discourse ä¸»é¢˜å›å¤ç¼–è¾‘å™¨</li>
                <li>âœ… Chat èŠå¤©ç¼–è¾‘å™¨</li>
                <li>âœ… ç§ä¿¡ç¼–è¾‘å™¨</li>
                <li>âœ… æ‰€æœ‰å¸¦æœ‰ <code>d-editor-input</code> æˆ– <code>chat-composer__input</code> ç±»çš„ç¼–è¾‘å™¨</li>
            </ul>
        </div>

        <h2>ğŸ”§ æŠ€æœ¯ç»†èŠ‚</h2>
        <div class="feature">
            <h3>è‡ªåŠ¨åˆå§‹åŒ–æ—¶æœº</h3>
            <ul>
                <li>é¡µé¢åŠ è½½å®Œæˆæ—¶</li>
                <li>æ£€æµ‹åˆ°æ–°çš„ç¼–è¾‘å™¨å·¥å…·æ æ—¶</li>
                <li>ç½‘ç»œè¯·æ±‚ï¼ˆdrafts/posts/t/ï¼‰å®Œæˆå</li>
                <li>æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®æ—¶</li>
            </ul>

            <h3>é˜²æ­¢é‡å¤ç»‘å®š</h3>
            <p>è„šæœ¬ä½¿ç”¨ dataset æ ‡è®°æ¥é˜²æ­¢é‡å¤ç»‘å®šäº‹ä»¶ï¼š</p>
            <div class="code-block">
textarea.dataset.emojiExtensionClickHandler = 'true';
textarea.dataset.emojiExtensionPasteHandler = 'true';
            </div>

            <h3>å›¾ç‰‡ä¸Šä¼  API</h3>
            <div class="code-block">
POST /uploads.json
Headers:
  X-CSRF-Token: [ä» meta æ ‡ç­¾è·å–]
FormData:
  file: [å›¾ç‰‡æ–‡ä»¶]
  type: 'composer'
  synchronous: 'true'
            </div>
        </div>

        <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
        <div class="warning-box">
            <strong>é‡è¦æç¤ºï¼š</strong>
            <ul>
                <li>å›¾ç‰‡ç²˜è´´åŠŸèƒ½ä»…åœ¨ Discourse è®ºå›ä¸­æœ‰æ•ˆ</li>
                <li>éœ€è¦æ­£ç¡®çš„ CSRF Token æ‰èƒ½ä¸Šä¼ å›¾ç‰‡</li>
                <li>ä¸Šä¼ çš„å›¾ç‰‡å¤§å°å—æœåŠ¡å™¨é™åˆ¶</li>
                <li>éƒ¨åˆ†æµè§ˆå™¨å¯èƒ½éœ€è¦æˆäºˆç²˜è´´æ¿æƒé™</li>
            </ul>
        </div>

        <h2>ğŸ“ æ›´æ–°æ—¥å¿—</h2>
        <div class="feature">
            <h3>ç‰ˆæœ¬ 1.1.7</h3>
            <ul>
                <li>âœ¨ æ–°å¢ï¼šTextarea ç‚¹å‡»è‡ªåŠ¨åˆ·æ–°æ‰©å±•æŒ‰é’®</li>
                <li>âœ¨ æ–°å¢ï¼šæ”¹è¿›çš„å›¾ç‰‡ç²˜è´´åŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨ä¸Šä¼ å¹¶æ’å…¥é“¾æ¥</li>
                <li>ğŸ”§ ä¼˜åŒ–ï¼šæ·»åŠ äº†æ›´å¤šçš„äº‹ä»¶ç›‘å¬å™¨ç»‘å®šæ£€æŸ¥</li>
                <li>ğŸ› ä¿®å¤ï¼šé˜²æ­¢é‡å¤ç»‘å®šäº‹ä»¶å¤„ç†å™¨</li>
                <li>ğŸ“š æ–‡æ¡£ï¼šæ·»åŠ äº†è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨æ–‡æ¡£</li>
            </ul>
        </div>

        <h2>ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’</h2>
        <div class="info-box">
            <strong>åç»­ä¼˜åŒ–æ–¹å‘ï¼š</strong>
            <ul>
                <li>æ·»åŠ å›¾ç‰‡ä¸Šä¼ è¿›åº¦æç¤º</li>
                <li>æ”¯æŒå¤šå›¾ç‰‡æ‰¹é‡ç²˜è´´</li>
                <li>æ·»åŠ ä¸Šä¼ å¤±è´¥é‡è¯•æœºåˆ¶</li>
                <li>æ”¯æŒè‡ªå®šä¹‰å›¾ç‰‡æ’å…¥æ ¼å¼</li>
                <li>æ·»åŠ å›¾ç‰‡å‹ç¼©é€‰é¡¹</li>
            </ul>
        </div>

        <div class="success-box" style="margin-top: 30px;">
            <strong>ğŸŠ å®Œæˆï¼</strong> æ‚¨çš„è„šæœ¬ç°åœ¨å·²ç»å…·å¤‡è¿™äº›æ–°åŠŸèƒ½ã€‚è¯·åœ¨ Discourse è®ºå›ä¸­æµ‹è¯•ä½¿ç”¨ã€‚
        </div>
    </div>

    <script>
        // æ¼”ç¤ºç²˜è´´æ£€æµ‹ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
        const demoTextarea = document.getElementById('demoTextarea');
        const pasteResult = document.getElementById('pasteResult');

        demoTextarea.addEventListener('paste', (e) => {
            const items = e.clipboardData?.items;
            if (!items) return;

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    pasteResult.innerHTML = `
                        <div class="success-box">
                            <strong>âœ… æ£€æµ‹åˆ°å›¾ç‰‡ç²˜è´´ï¼</strong><br>
                            ç±»å‹: ${item.type}<br>
                            åœ¨å®é™…çš„ Discourse è®ºå›ä¸­ï¼Œè¿™å¼ å›¾ç‰‡ä¼šè¢«è‡ªåŠ¨ä¸Šä¼ å¹¶æ’å…¥é“¾æ¥ã€‚
                        </div>
                    `;
                    return;
                }
            }
            
            pasteResult.innerHTML = `
                <div class="info-box">
                    <strong>â„¹ï¸ æ£€æµ‹åˆ°æ–‡æœ¬ç²˜è´´</strong><br>
                    è¯·ç²˜è´´å›¾ç‰‡æ–‡ä»¶æ¥æµ‹è¯•å›¾ç‰‡ç²˜è´´åŠŸèƒ½ã€‚
                </div>
            `;
        });
    </script>
</body>
</html>
